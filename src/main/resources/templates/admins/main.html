<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/admin}" layout:fragment="admin">

<head>
  <meta charset="UTF-8"/>
</head>

<body>
  <main
    class="flex-1 rounded-[80px] bg-[#f5f6fb] overflow-hidden flex flex-row items-start justify-start p-[30px] box-border gap-[30px] max-w-[calc(100%_-_185px)] text-left text-[20px] text-[#000] font-[Inter] mq825:max-w-full mq1125:pt-[20px] mq1125:pb-[20px] mq1125:box-border mq1400:flex-wrap">
    <div
      class="flex-1 rounded-[50px] bg-[#eaecf8] overflow-hidden flex flex-col items-end justify-start py-[30px] px-[8px] box-border gap-[30px] max-w-full mq1125:pt-[20px] mq1125:pb-[20px] mq1125:box-border mq1400:flex-1">
      <div
        class="self-stretch h-[23px] relative text-[24px] font-semibold text-center flex items-center justify-center shrink-0 mq450:text-[19px]">
        방문자 요약
      </div>
      <div
        class="self-stretch flex flex-row items-start justify-end py-[0px] px-[38px] box-border max-w-full text-[#343c6a]">
        <div class="flex-1 flex flex-col items-start justify-start gap-[15px] max-w-full">
          <div class="self-stretch relative font-semibold mq450:text-[16px]">
            방문자 수
          </div>
          <div
            class="self-stretch h-[263px] relative rounded-[25px] bg-[#fff] max-w-full text-right text-[13px] text-[#718ebf] mq825:h-auto mq825:min-h-[263]">
            <div class="absolute top-[0px] left-[0px] rounded-[25px] bg-[#fff] w-full h-full hidden"></div>
            <div class="absolute top-[92.3px] left-[69px] bg-[#f3f3f5] w-[631px] h-[0.8px] z-[1]"></div>
            <div class="absolute top-[122.5px] left-[69px] bg-[#f3f3f5] w-[631px] h-[0.8px] z-[1]"></div>
            <div class="absolute top-[152.7px] left-[69px] bg-[#f3f3f5] w-[631px] h-[0.8px] z-[1]"></div>
            <div class="absolute top-[183px] left-[69px] bg-[#f3f3f5] w-[631px] h-[0.8px] z-[1]"></div>
            <div class="absolute top-[213.2px] left-[69px] bg-[#f3f3f5] w-[631px] h-[0.8px] z-[1]"></div>
            <div class="absolute top-[55.5px] left-[33px] flex flex-col items-start justify-start gap-[17.1px]">
              <div class="relative inline-block min-w-[25px] z-[1]">
                500
              </div>
              <div class="flex flex-row items-start justify-start py-[0px] pl-[1px] pr-[0px]">
                <div class="relative inline-block min-w-[25px] z-[1]">
                  400
                </div>
              </div>
              <div class="flex flex-row items-start justify-start py-[0px] pl-[1px] pr-[0px]">
                <div class="relative inline-block min-w-[25px] z-[1]">
                  300
                </div>
              </div>
              <div class="relative inline-block min-w-[25px] z-[1]">
                200
              </div>
              <div class="w-[23px] relative inline-block min-w-[23px] z-[1]">
                100
              </div>
              <div class="flex flex-row items-start justify-start py-[0px] pl-[14px] pr-[3px]">
                <div class="relative inline-block min-w-[9px] z-[1]">0</div>
              </div>
            </div>
            <div
              class="absolute top-[22.9px] left-[69px] w-[631px] flex flex-col items-end justify-start gap-[24.5px] max-w-full text-left text-[15px]">
              <div class="flex flex-row items-start justify-start gap-[30px]">
                <div class="flex flex-row items-start justify-start gap-[10px]">
                  <div class="flex flex-col items-start justify-start pt-[1.6px] px-[0px] pb-[0px]">
                    <div class="w-[15px] h-[12.3px] relative rounded-[50%] bg-[#16dbcc] z-[1]"></div>
                  </div>
                  <div class="relative leading-[14.7px] inline-block min-w-[50px] z-[1]">
                    Diposit
                  </div>
                </div>
                <div class="flex flex-row items-start justify-start gap-[10px]">
                  <div class="flex flex-col items-start justify-start pt-[1.6px] px-[0px] pb-[0px]">
                    <div class="w-[15px] h-[12.3px] relative rounded-[50%] bg-[#ff82ac] z-[1]"></div>
                  </div>
                  <div class="relative leading-[14.7px] inline-block min-w-[68px] z-[1]">
                    Withdraw
                  </div>
                </div>
              </div>
              <div
                class="self-stretch flex flex-col items-end justify-start gap-[4.9px] max-w-full text-center text-[13px]">
                <div class="self-stretch h-[0.8px] relative bg-[#f3f3f5] z-[1]"></div>
                <div
                  class="self-stretch flex flex-row items-start justify-end py-[0px] pl-[25px] pr-[24px] box-border max-w-full">
                  <div class="flex-1 flex flex-col items-start justify-start gap-[13.9px] max-w-full">
                    <div class="self-stretch flex flex-row items-end justify-between gap-[20px] mq825:flex-wrap">
                      <div class="h-[145.4px] flex flex-row items-end justify-start gap-[12px]">
                        <div class="self-stretch w-[15px] relative rounded-[30px] bg-[#1814f3] z-[2]"></div>
                        <div class="h-[74.3px] w-[15px] relative rounded-[30px] bg-[#16dbcc] z-[2]"></div>
                      </div>
                      <div class="h-[106.2px] flex flex-row items-end justify-start gap-[12px]">
                        <div class="self-stretch w-[15px] relative rounded-[30px] bg-[#1814f3] z-[2]"></div>
                        <div class="h-[40px] w-[15px] relative rounded-[30px] bg-[#16dbcc] z-[2]"></div>
                      </div>
                      <div class="h-[99.6px] flex flex-row items-end justify-start gap-[12px]">
                        <div class="self-stretch w-[15px] relative rounded-[30px] bg-[#1814f3] z-[2]"></div>
                        <div class="h-[80px] w-[15px] relative rounded-[30px] bg-[#16dbcc] z-[2]"></div>
                      </div>
                      <div class="h-[145.4px] flex flex-row items-end justify-start gap-[12px]">
                        <div class="self-stretch w-[15px] relative rounded-[30px] bg-[#1814f3] z-[2]"></div>
                        <div class="h-[112.7px] w-[15px] relative rounded-[30px] bg-[#16dbcc] z-[2]"></div>
                      </div>
                      <div class="h-[74.3px] flex flex-row items-end justify-start gap-[12px]">
                        <div class="h-[46.6px] w-[15px] relative rounded-[30px] bg-[#1814f3] z-[2]"></div>
                        <div class="self-stretch w-[15px] relative rounded-[30px] bg-[#16dbcc] z-[2]"></div>
                      </div>
                      <div class="h-[118.5px] flex flex-row items-end justify-start gap-[12px]">
                        <div class="self-stretch w-[15px] relative rounded-[30px] bg-[#1814f3] z-[2]"></div>
                        <div class="h-[74.3px] w-[15px] relative rounded-[30px] bg-[#16dbcc] z-[2]"></div>
                      </div>
                      <div class="h-[120.1px] flex flex-row items-end justify-start gap-[12px]">
                        <div class="self-stretch w-[15px] relative rounded-[30px] bg-[#1814f3] z-[2]"></div>
                        <div class="h-[102.9px] w-[15px] relative rounded-[30px] bg-[#16dbcc] z-[2]"></div>
                      </div>
                    </div>
                    <div
                      class="self-stretch flex flex-row items-start justify-start py-[0px] pl-[11px] pr-[13px] box-border max-w-full">
                      <div
                        class="flex-1 flex flex-row items-start justify-between py-[0px] pl-[0px] pr-[2px] box-border max-w-full gap-[20px] mq825:flex-wrap">
                        <div
                          class="w-[24px] flex flex-col items-start justify-start py-[0px] pl-[0px] pr-[3px] box-border">
                          <div class="self-stretch relative inline-block min-w-[21px] z-[1]">
                            Sat
                          </div>
                        </div>
                        <div class="relative inline-block min-w-[24px] z-[1]">
                          Sun
                        </div>
                        <div class="relative inline-block min-w-[28px] z-[1]">
                          Mon
                        </div>
                        <div class="relative inline-block min-w-[23px] z-[1]">
                          Tue
                        </div>
                        <div class="relative inline-block min-w-[28px] z-[1]">
                          Wed
                        </div>
                        <div class="flex flex-col items-start justify-start py-[0px] pl-[0px] pr-[6px]">
                          <div class="relative inline-block min-w-[24px] z-[1]">
                            Thu
                          </div>
                        </div>
                        <div class="relative inline-block min-w-[16px] z-[1] mq825:w-full mq825:h-[16px]">
                          Fri
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div
        class="w-[786px] flex flex-row items-start justify-end py-[0px] px-[40px] box-border max-w-full text-[#333b69]">
        <div
          class="flex-1 flex flex-row items-start justify-start gap-[35px] max-w-full mq825:gap-[17px] mq825:flex-wrap">
          <div
            class="w-[315.5px] flex flex-col items-start justify-start pt-[20px] px-[0px] pb-[0px] box-border min-w-[315.5px] mq825:flex-1">
            <div class="self-stretch flex flex-col items-start justify-start gap-[15px]">
              <div class="self-stretch relative font-semibold mq450:text-[16px]">
                방문자 OS
              </div>
              <div
                class="self-stretch flex flex-row items-start justify-start py-[0px] pl-[32px] pr-[33px] text-[15px] text-[#718ebf]">
                <div
                  class="flex-1 rounded-[25px] bg-[#fff] flex flex-col items-end justify-start pt-[21.4px] px-[35px] pb-[20px] gap-[11.3px]">
                  <div class="w-[250.3px] h-[221px] relative rounded-[25px] bg-[#fff] hidden"></div>
                  <div class="self-stretch flex flex-row items-start justify-end py-[0px] pl-[26px] pr-[19px]">
                    <img class="h-[132.7px] w-[134.5px] relative z-[1]" loading="lazy" alt=""
                      src="/public/group-346.svg" />
                  </div>
                  <div class="self-stretch flex flex-col items-start justify-start gap-[10px]">
                    <div class="self-stretch flex flex-row items-start justify-between gap-[20px] mq450:flex-wrap">
                      <div class="w-[68.6px] flex flex-row items-start justify-start gap-[8.6px]">
                        <div class="h-[10.7px] w-[10.7px] relative rounded-[50%] bg-[#4c78ff] z-[1]"></div>
                        <div class="h-[12.8px] flex-1 relative font-medium inline-block z-[1]">
                          DBL Bank
                        </div>
                      </div>
                      <div class="w-[70.1px] flex flex-row items-start justify-start gap-[8.6px]">
                        <div class="h-[10.7px] w-[10.7px] relative rounded-[50%] bg-[#ff82ac] z-[1]"></div>
                        <div class="h-[12.8px] flex-1 relative font-medium inline-block z-[1]">
                          BRC Bank
                        </div>
                      </div>
                    </div>
                    <div class="self-stretch flex flex-row items-start justify-between gap-[20px] mq450:flex-wrap">
                      <div class="w-[72.2px] flex flex-row items-start justify-start gap-[8.6px]">
                        <div class="h-[10.7px] w-[10.7px] relative rounded-[50%] bg-[#16dbcc] z-[1]"></div>
                        <div class="h-[12.8px] flex-1 relative font-medium inline-block z-[1]">
                          ABM Bank
                        </div>
                      </div>
                      <div class="w-[72.2px] flex flex-row items-start justify-start gap-[8.6px]">
                        <div class="h-[10.7px] w-[10.7px] relative rounded-[50%] bg-[#ffbb38] z-[1]"></div>
                        <div class="h-[12.8px] flex-1 relative font-medium inline-block z-[1]">
                          MCP Bank
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="self-stretch relative font-semibold mq450:text-[16px]">
                방문자 접속기기
              </div>
              <div
                class="self-stretch flex flex-row items-start justify-start py-[0px] pl-[32px] pr-[33px] text-[15px] text-[#718ebf]">
                <div
                  class="flex-1 rounded-[25px] bg-[#fff] flex flex-col items-end justify-start pt-[21.4px] px-[35px] pb-[20px] gap-[11.3px]">
                  <div class="w-[250.3px] h-[221px] relative rounded-[25px] bg-[#fff] hidden"></div>
                  <div class="self-stretch flex flex-row items-start justify-end py-[0px] pl-[26px] pr-[19px]">
                    <img class="h-[132.7px] w-[134.5px] relative z-[1]" loading="lazy" alt=""
                      src="/public/group-346.svg" />
                  </div>
                  <div class="self-stretch flex flex-col items-start justify-start gap-[10px]">
                    <div class="self-stretch flex flex-row items-start justify-between gap-[20px] mq450:flex-wrap">
                      <div class="w-[68.6px] flex flex-row items-start justify-start gap-[8.6px]">
                        <div class="h-[10.7px] w-[10.7px] relative rounded-[50%] bg-[#4c78ff] z-[1]"></div>
                        <div class="h-[12.8px] flex-1 relative font-medium inline-block z-[1]">
                          DBL Bank
                        </div>
                      </div>
                      <div class="w-[70.1px] flex flex-row items-start justify-start gap-[8.6px]">
                        <div class="h-[10.7px] w-[10.7px] relative rounded-[50%] bg-[#ff82ac] z-[1]"></div>
                        <div class="h-[12.8px] flex-1 relative font-medium inline-block z-[1]">
                          BRC Bank
                        </div>
                      </div>
                    </div>
                    <div class="self-stretch flex flex-row items-start justify-between gap-[20px] mq450:flex-wrap">
                      <div class="w-[72.2px] flex flex-row items-start justify-start gap-[8.6px]">
                        <div class="h-[10.7px] w-[10.7px] relative rounded-[50%] bg-[#16dbcc] z-[1]"></div>
                        <div class="h-[12.8px] flex-1 relative font-medium inline-block z-[1]">
                          ABM Bank
                        </div>
                      </div>
                      <div class="w-[72.2px] flex flex-row items-start justify-start gap-[8.6px]">
                        <div class="h-[10.7px] w-[10.7px] relative rounded-[50%] bg-[#ffbb38] z-[1]"></div>
                        <div class="h-[12.8px] flex-1 relative font-medium inline-block z-[1]">
                          MCP Bank
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 신규 회원 테이블-->
          <div 
            class="flex-1 overflow-hidden flex flex-col items-center justify-start p-[20px] box-border gap-[15px] min-w-[231px] max-w-full">
            <label class="font-semibold">
              신규 회원
            </label>

            <div th:if="${memList == null}">
              최근에 가입한 신규 회원이 없습니다.
            </div>

            <div th:if="${memList != null}"
              class="self-stretch h-[496px] overflow-hidden shrink-0 flex flex-col items-center justify-start py-[0px] px-[4px] box-border text-[16px] text-[#343a40]">
              <table>
                <thead>
                  <tr>
                    <th>이메일</th>
                    <th>가입일</th>
                  </tr>
                </thead>
                <tbody>
                  <tr th:each="mem : ${memList}">
                    <td th:text="${mem.memberProfile.email}"></td>
                    <td th:text="${mem.memJoinDate}"></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 가맹점 현황 -->
    <div class="rounded-[50px] bg-[#eaecf8] flex flex-col items-start justify-start p-[20px] gap-[30px] text-[16px] ">
      <label class="w-full text-center font-semibold text-[24px]">가맹점 현황</label>
      
      <label class="text-[20px] font-semibold text-[#343c6a]">
        판매실적 TOP5 가맹점
      </label>
      <div class="w-full h-[400px] overflow-hidden">
        <canvas id="myChart"></canvas>
      </div>


      <label class="text-[20px] font-semibold text-[#343c6a]">
        이번달 정산 현황
      </label>
      <div
        class="self-stretch h-[96px] shadow-[0px_2px_2px_rgba(0,_0,_0,_0.25)] rounded-[30px] bg-[rgba(52,60,106,0.1)] shrink-0 flex flex-row items-center justify-center box-border gap-[10px]">
        
        <div class="w-[150px] h-[50px] bg-[#fff] self-stretch rounded-[10px] shrink-0 flex flex-row items-center justify-center">
          <div class="w-1/2 h-full text-center border-[#a4a4a4] border-[1px] border-solid rounded-l-[10px]">
            승인 대기
          </div>
          <div class="w-1/2 h-full text-center border-[#a4a4a4] border-[1px] border-solid rounded-r-[10px]"
          th:text="${calRequestCount}">
            n 건
          </div>
        </div>
        
        <div class="cursor-pointer border-[#a4a4a4] border-[1px] border-solid py-[0px] px-[19px] bg-[#fff] self-stretch rounded-[10px] overflow-x-auto shrink-0 flex flex-row items-start justify-start gap-[21.5px]">
          <div class="w-1/2 text-center">
            승인
          </div>
          <div class="w-1/2 text-center"
          th:text="${calApproveCount}">
            n 건
          </div>
        </div>

        <div class="cursor-pointer border-[#a4a4a4] border-[1px] border-solid py-[0px] px-[19px] bg-[#fff] self-stretch rounded-[10px] overflow-x-auto shrink-0 flex flex-row items-start justify-start gap-[21.5px]">
          <div class="w-1/2 text-center">
            완료
          </div>
          <div class="w-1/2 text-center"
          th:text="${calCompletedCount}">
            n 건
          </div>
        </div>
      </div>


      <label class="self-stretch relative text-[20px] font-semibold text-[#343c6a] mq450:text-[16px]">
        이번달 입점 현황
      </label>
      
      <div
        class="self-stretch h-[96px] shadow-[0px_2px_2px_rgba(0,_0,_0,_0.25)] rounded-[30px] bg-[rgba(52,60,106,0.1)] shrink-0 flex flex-row items-start justify-start py-[20px] px-[79px] box-border gap-[10px]">
        
        <div class="cursor-pointer border-[#a4a4a4] border-[1px] border-solid py-[0px] px-[19px] bg-[#fff] self-stretch rounded-[10px] overflow-x-auto shrink-0 flex flex-row items-start justify-start gap-[21.5px]">
          <div class="w-1/2 text-center">
            입점 요청 대기
          </div>
          <div class="w-1/2 text-center"
          th:text="${reqApplyCount}">
            n 건
          </div>
        </div>
        
        <div class="cursor-pointer border-[#a4a4a4] border-[1px] border-solid py-[0px] px-[19px] bg-[#fff] self-stretch rounded-[10px] overflow-x-auto shrink-0 flex flex-row items-start justify-start gap-[21.5px]">
          <div class="w-1/2 text-center">
            입점 완료
          </div>
          <div class="w-1/2 text-center"
          th:text="${reqApproveCount}">
            n 건
          </div>
        </div>

      </div>

    </div>
  </main>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script th:inline="javascript">
    // 차트 데이터
    var top5List = /*[[${top5List}]]*/[];
    console.log(top5List);

    var label = top5List.map(function (item) {
      return item.hostName; // Assuming Top5SalesDTO has a field 'regionName'
    });

    var data = top5List.map(function (item) {
      return item.totalSales; // Assuming Top5SalesDTO has a field 'salesAmount'
    });

    var ctx = document.getElementById('myChart');
    var salesChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: label,
        datasets: [{
          label: 'Sales Amount',
          data: data,
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });


    axios.post('https://accounts.google.com/o/oauth2/token',
        {
            "client_id": "160531611477-l7nuhmg2ucugqaov6bc710o83fu07tat.apps.googleusercontent.com",
            "client_secret": "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",
            "refresh_token": "1//04co7JmjiWeB9CgYIARAAGAQSNwF-L9IrFIWb6wIHYwu4bT64Ffo2l4nCDf0QyN3XeqsN3wyrcAEZ3oCVJBjyWtg652IIZHuhaSs",
            "grant_type": "refresh_token",
            "scope": "https://www.googleapis.com/auth/analytics https://www.googleapis.com/auth/analytics.readonly", 
        }
    )
    .then((response) => {
        const accessToken = response.data.access_token;
        console.log(accessToken);

        // 만약 정상적으로 'access_token'을 받았다면, 기본 보고서(runReport)를 호출하는 요청을 보낸다.
        axios.post(`https://analyticsdata.googleapis.com/v1beta/properties/461681623:runReport`,
            {
                // runReport 요청에 필요한 'dimensions', 'metrics', 'dataRanges'를 data에 포함하여 전송한다.
                "dimensions": [{ "name":"date" }],
                "metrics": [{ "name":"activeUsers" }, { "name":"screenPageViews" }, { "name":"sessions" }],
                "dateRanges": [{ "startDate":"2024-01-01", "endDate":"today" }],
                "keepEmptyRows": true,
            },
            {
                // 이전에 전달받은 'access_token'을 headers에 담는다(인증).
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            }
        )
        // 정상적으로 응답을 받았다면, 콘솔창에 runReport의 결과가 나타날 것이다.
        .then((response) => {
            console.log('Report Result:', response.data);
        })
        // runReport가 정상적으로 호출되지 않았다면, [REPORT ERROR]라는 문구와 함께 콘솔창에 에러가 보일 것이다.
        .catch((error) => {
            console.log('[REPORT ERROR] ', error);
        });
    })
    // 'access_token'을 호출하는 것에 실패했다면, [TOKEN ERROR]라는 문구와 함께 콘솔창에 에러가 보일 것이다.
    .catch((error) => {
        console.log('[TOKEN ERROR] ', error);
    });

  </script>
</body>

</html>