<!DOCTYPE html>
<html lang="ko" layout:decorate="~{layout/search_main}"
      layout:fragment="search"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/></head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider/dist/nouislider.min.css">
    <link rel="stylesheet" href="/css/component/slider.css">
<body>
<div
        class="w-full relative bg-[#fff] flex flex-col items-start justify-start pt-[0px] px-[0px] pb-[100px] box-border leading-[normal] tracking-[normal]"
>
    <main
            class="self-stretch flex flex-row items-start justify-center py-[0px] px-[20px] box-border max-w-full"
    >
        <section
                class="w-[1200px] flex flex-row items-start justify-start pt-[16px] px-[0px] pb-[0px] box-border max-w-[1200px] text-left text-[15.1px] text-[#333] font-[Inter] lg:max-w-full mq1050:h-auto"
        >
            <div
                    class="flex-1 flex flex-row items-start justify-start gap-[16px] max-w-full shrink-0"
            >
                <div
                        class="w-[288px] flex flex-col items-start justify-start pt-[36px] px-[0px] pb-[0px] box-border mq1050:hidden"
                >
                    <div class="self-stretch flex flex-col items-start justify-start">
                        <div
                                class="self-stretch flex flex-row items-start justify-start pt-[0px] px-[0px] pb-[20px]"
                        >
                            <div
                                    class="flex-1 rounded-[12px] overflow-hidden flex flex-row items-start justify-start py-[66.4px] px-[80px] bg-[url('/image/domestic-accommodations/map@3x.png')] bg-cover bg-no-repeat bg-[top] mq450:pl-[20px] mq450:pr-[20px] mq450:box-border"
                            >
                                <button class="btn btn-primary w-32 h-[42px] flex flex-row items-center justify-center font-semibold text-[13.1px]  font-[Inter] text-[#fff] text-center"
                                        onclick="showmap()"
                                >
                                    지도 보기
                                </button>
                            </div>
                        </div>
                        <div id="main-filter" th:insert="~{component/search/searchfilter :: filterbar('main')}"></div>
                    </div>
                </div>
                <div
                        class="flex-1 flex flex-col items-start justify-start pt-[0px] pb-[104px] pl-[16px] pr-[0px] box-border max-w-[calc(100%_-_304px)] text-[10.3px] text-[#707070] lg:pb-[29px] lg:box-border mq750:pb-[20px] mq750:box-border mq1050:max-w-full"
                >
                    <div
                            class="self-stretch bg-[#fff] flex flex-row items-center justify-between pt-[16px] px-[0px] pb-[20px] box-border min-h-[80px] [row-gap:20px] max-w-full gap-[0px] text-[22.9px] text-[#333] mq1050:flex-wrap"
                    >
                        <div
                                class="w-[732px] flex flex-col items-start justify-start py-[0px] pl-[0px] pr-[16px] box-border max-w-full"
                        >
                            <div
                                    class="self-stretch overflow-hidden flex flex-row items-start justify-start py-[0px] pl-[0px] pr-[534px] [row-gap:20px] mq450:pr-[20px] mq450:box-border mq750:flex-wrap mq750:pr-[267px] mq750:box-border"
                            >
                                <h3
                                        class="m-[0px] w-[9px] relative text-[24px] font-bold font-[inherit] flex items-center mq450:text-[19px] mq750:w-full mq750:h-[9px]"
                                >
                                    '
                                </h3>
                                <div
                                        class="overflow-hidden flex flex-col items-start justify-start pt-[0px] px-[0px] pb-[2px] text-[22.5px]"
                                >
                                    <a
                                            class="[text-decoration:none] relative font-bold text-[inherit] inline-block min-w-[45px] mq450:text-[18px]"
                                    >강릉</a
                                    >
                                </div>
                                <b
                                        class="relative inline-block min-w-[8px] mq450:text-[18px] mq750:w-full mq750:h-[8px]"
                                >'</b
                                >
                                <a
                                        class="[text-decoration:none] relative font-bold text-[inherit] inline-block min-w-[120px] mq450:text-[18px]"
                                >
                                    숙소 660개</a
                                >
                            </div>
                        </div>
                        <div
                                class="flex flex-col items-start justify-start text-[15px]"
                        >

                                <div id="dropdown-filter"
                                        class="dropdown pr-[9px] min-w-[41.48px]"
                                >
                                    <button id="dropdown-filter-button"
                                            class="btn btn-light dropdown-toggle w-[100%]"
                                            type="button" data-bs-toggle="dropdown" aria-expanded="false" value="rating">
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li value="rating"><p class="dropdown-item">평점높은순</p></li>
                                        <li value="review"><p class="dropdown-item">리뷰많은순</p></li>
                                        <li value="lowPrice"><p class="dropdown-item">낮은가격순</p></li>
                                        <li value="highPrice"><p class="dropdown-item">높은가격순</p></li>
                                    </ul>
                                </div>
                        </div>
                    </div>
                    <div
                            class="self-stretch bg-[#fff] border-[#ebebeb] border-b-[1px] border-solid box-border flex flex-col items-start justify-start pt-[20px] px-[0px] pb-[19px] max-w-full cursor-pointer"
                            id="cardWrapperContainer">
                        <div
                                class="self-stretch flex flex-row items-start justify-start [row-gap:20px] max-w-full mq750:flex-wrap"
                        >
                            <div
                                    class="h-[240px] w-[396px] flex flex-col items-start justify-center min-w-[396px] max-w-full mq750:flex-1 mq750:min-w-full"
                            >
                                <img
                                        alt=""
                                        class="self-stretch flex-1 relative rounded-[12px] max-w-full overflow-hidden max-h-full object-cover mq750:self-stretch mq750:w-auto"
                                        loading="lazy"
                                        src="/image/domestic-accommodations/uvjpvw9k8yjwjpg@2x.png"
                                />
                            </div>
                            <div
                                    class="flex-1 overflow-hidden flex flex-col items-start justify-between py-[0px] pl-[20px] pr-[0px] box-border min-w-[315px] min-h-[240px] max-w-full mq750:min-h-[auto]"
                            >
                                <div
                                        class="self-stretch flex flex-col items-start justify-start pt-[0px] px-[0px] pb-[4px]"
                                >
                                    <div
                                            class="self-stretch flex flex-col items-start justify-start gap-[4px]"
                                    >
                                        <div
                                                class="self-stretch flex flex-col items-start justify-start gap-[2px]"
                                        >
                                            <div
                                                    class="self-stretch flex flex-row items-center justify-start"
                                            >
                                                <div
                                                        class="flex flex-row items-center justify-start"
                                                >
                                                    <div
                                                            class="relative font-semibold inline-block min-w-[21px]"
                                                    >
                                                        펜션
                                                    </div>
                                                </div>
                                            </div>
                                            <div
                                                    class="self-stretch flex flex-col items-start justify-start text-[16.9px] text-[#333]"
                                            >
                                                <b class="self-stretch relative"
                                                >강릉 라임비치 스파 펜션</b
                                                >
                                            </div>
                                        </div>
                                        <div
                                                class="self-stretch flex flex-row items-center justify-start py-[0px] pl-[0px] pr-[361px] [row-gap:20px] text-[11.6px] text-[#333] mq450:pr-[180px] mq450:box-border mq750:flex-wrap"
                                        >
                                            <div
                                                    class="flex flex-col items-start justify-start py-[0px] pl-[0px] pr-[6px]"
                                            >
                                                <div
                                                        class="rounded-[6px] bg-[#ffad0a] flex flex-row items-center justify-center pt-[4px] pb-[3px] pl-[3px] pr-[5px]"
                                                >
                                                    <div
                                                            class="flex flex-col items-start justify-start pt-[0px] pb-[2px] pl-[0px] pr-[2px]"
                                                    >
                                                        <div
                                                                class="overflow-hidden flex flex-col items-center justify-center"
                                                        >
                                                            <img
                                                                    alt=""
                                                                    class="w-[12px] h-[12px] relative"
                                                                    src="/image/domestic-accommodations/frame.svg"
                                                            />
                                                        </div>
                                                    </div>
                                                    <div
                                                            class="flex flex-col items-start justify-start"
                                                    >
                                                        <b class="relative inline-block min-w-[19px]"
                                                        >9.2</b
                                                        >
                                                    </div>
                                                </div>
                                            </div>
                                            <div
                                                    class="flex flex-col items-start justify-start text-[12.3px] text-[#707070] mq450:ml-[0px]"
                                            >
                                                <div
                                                        class="relative font-medium inline-block min-w-[56px]"
                                                >
                                                    54명 평가
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div
                                        class="self-stretch flex flex-col items-start justify-start pt-[8px] pb-[0px] pl-[12px] pr-[0px] text-right text-[12.2px] text-[#999]"
                                >
                                    <div
                                            class="self-stretch flex flex-col items-end justify-start"
                                    >
                                        <div class="flex flex-col items-start justify-start">
                                            <div class="flex flex-col items-end justify-start">
                                                <div
                                                        class="relative font-medium inline-block min-w-[74px] whitespace-nowrap"
                                                >
                                                    다른 날짜 확인
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div
                            class="self-stretch bg-[#fff] border-[#ebebeb] border-b-[1px] border-solid box-border flex flex-col items-start justify-start pt-[20px] px-[0px] pb-[19px] max-w-full cursor-pointer"
                            id="linkContainer"
                    >
                        <div
                                class="self-stretch flex flex-row items-start justify-start [row-gap:20px] max-w-full mq750:flex-wrap"
                        >
                            <div
                                    class="h-[240px] w-[396px] flex flex-col items-start justify-center relative min-w-[396px] max-w-full mq750:flex-1 mq750:min-w-full"
                            >
                                <img
                                        alt=""
                                        class="self-stretch flex-1 relative max-w-full overflow-hidden max-h-full object-cover mq750:self-stretch mq750:w-auto"
                                        loading="lazy"
                                        src="/image/domestic-accommodations/container@2x.png"
                                />

                                <div
                                        class="w-[8.08%] h-[35px] !m-[0] absolute top-[14px] right-[88.38%] left-[3.54%] "
                                ></div>
                            </div>
                            <div
                                    class="flex-1 overflow-hidden flex flex-col items-start justify-start py-[0px] pl-[20px] pr-[0px] box-border gap-[123px] min-w-[315px] max-w-full mq750:gap-[61px]"
                            >
                                <div
                                        class="self-stretch flex flex-col items-start justify-start pt-[0px] px-[0px] pb-[4px]"
                                >
                                    <div
                                            class="self-stretch flex flex-col items-start justify-start gap-[4px]"
                                    >
                                        <div
                                                class="self-stretch flex flex-col items-start justify-start gap-[2px]"
                                        >
                                            <div
                                                    class="self-stretch flex flex-row items-center justify-start"
                                            >
                                                <div
                                                        class="flex flex-row items-center justify-start"
                                                >
                                                    <div
                                                            class="relative font-semibold inline-block min-w-[21px]"
                                                    >
                                                        펜션
                                                    </div>
                                                </div>
                                            </div>
                                            <div
                                                    class="self-stretch flex flex-col items-start justify-start text-[17.3px] text-[#333]"
                                            >
                                                <b class="self-stretch relative">강릉 here365</b>
                                            </div>
                                        </div>
                                        <div
                                                class="self-stretch flex flex-row items-center justify-start py-[0px] pl-[0px] pr-[359px] text-[11.6px] text-[#333] mq450:pr-[179px] mq450:box-border mq750:flex-wrap"
                                        >
                                            <div
                                                    class="flex flex-col items-start justify-start py-[0px] pl-[0px] pr-[6px]"
                                            >
                                                <div
                                                        class="rounded-[6px] bg-[#ffad0a] flex flex-row items-center justify-center pt-[4px] pb-[3px] pl-[3px] pr-[5px]"
                                                >
                                                    <div
                                                            class="flex flex-col items-start justify-start pt-[0px] pb-[2px] pl-[0px] pr-[2px]"
                                                    >
                                                        <div
                                                                class="overflow-hidden flex flex-col items-center justify-center"
                                                        >
                                                            <img
                                                                    alt=""
                                                                    class="w-[12px] h-[12px] relative"
                                                                    src="/image/domestic-accommodations/frame.svg"
                                                            />
                                                        </div>
                                                    </div>
                                                    <div
                                                            class="flex flex-col items-start justify-start"
                                                    >
                                                        <b class="relative inline-block min-w-[19px]"
                                                        >9.8</b
                                                        >
                                                    </div>
                                                </div>
                                            </div>
                                            <div
                                                    class="flex flex-col items-start justify-start text-[12.3px] text-[#707070]"
                                            >
                                                <div
                                                        class="relative font-medium inline-block min-w-[58px]"
                                                >
                                                    112명 평가
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div
                                        class="self-stretch flex flex-col items-start justify-start pt-[8px] pb-[0px] pl-[12px] pr-[0px] text-[19.2px] text-[#333]"
                                >
                                    <div
                                            class="self-stretch flex flex-col items-end justify-start"
                                    >
                                        <div class="flex flex-row items-center justify-start">
                                            <div class="flex flex-col items-start justify-start">
                                                <b class="relative inline-block min-w-[80px]"
                                                >104,500</b
                                                >
                                            </div>
                                            <div
                                                    class="flex flex-col items-start justify-start pt-[2px] px-[0px] pb-[1px] text-[16px]"
                                            >
                                                <b class="relative inline-block min-w-[15px]">원</b>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div
                            class="self-stretch flex flex-row items-start justify-center pt-[40px] px-[20px] pb-[0px] text-center text-[12px] text-[#000]"
                    >
                        <div class="flex flex-col items-start justify-start">
                            <div class="flex flex-row items-center justify-center">
                                <div
                                        class="flex flex-col items-start justify-start py-[0px] pl-[0px] pr-[4px]"
                                >
                                    <div
                                            class="w-[32px] h-[32px] rounded-[500px] flex flex-row items-center justify-center p-[8px] box-border"
                                    >
                                        <img
                                                alt=""
                                                class="h-[16px] w-[16px] relative"
                                                src="/image/domestic-accommodations/svg-2.svg"
                                        />
                                    </div>
                                </div>
                                <div
                                        class="flex flex-col items-start justify-start py-[0px] px-[4px]"
                                >
                                    <div
                                            class="w-[32px] h-[32px] rounded-[500px] flex flex-row items-center justify-center py-[8.5px] px-[12px] box-border"
                                    >
                                        <div
                                                class="relative font-semibold inline-block min-w-[8px]"
                                        >
                                            6
                                        </div>
                                    </div>
                                </div>
                                <div
                                        class="flex flex-col items-start justify-start py-[0px] px-[4px]"
                                >
                                    <div
                                            class="w-[32px] h-[32px] rounded-[500px] flex flex-row items-center justify-center py-[8.5px] px-[12px] box-border"
                                    >
                                        <div
                                                class="w-[8px] relative font-semibold flex items-center justify-center min-w-[8px]"
                                        >
                                            7
                                        </div>
                                    </div>
                                </div>
                                <div
                                        class="flex flex-col items-start justify-start py-[0px] px-[4px]"
                                >
                                    <div
                                            class="w-[32px] h-[32px] rounded-[500px] flex flex-row items-center justify-center py-[8.5px] px-[12px] box-border"
                                    >
                                        <div
                                                class="relative font-semibold inline-block min-w-[8px]"
                                        >
                                            8
                                        </div>
                                    </div>
                                </div>
                                <div
                                        class="flex flex-col items-start justify-start py-[0px] px-[4px]"
                                >
                                    <div
                                            class="w-[32px] h-[32px] rounded-[500px] flex flex-row items-center justify-center py-[8.5px] px-[12px] box-border"
                                    >
                                        <div
                                                class="relative font-semibold inline-block min-w-[8px]"
                                        >
                                            9
                                        </div>
                                    </div>
                                </div>
                                <div
                                        class="flex flex-col items-start justify-start py-[0px] px-[4px] text-[11.6px] text-[#fff]"
                                >
                                    <div
                                            class="w-[32px] h-[32px] rounded-[500px] bg-[#1273e4] flex flex-row items-center justify-center p-[9px] box-border"
                                    >
                                        <div
                                                class="w-[14px] relative font-semibold flex items-center justify-center min-w-[14px]"
                                        >
                                            10
                                        </div>
                                    </div>
                                </div>
                                <div
                                        class="flex flex-col items-start justify-start py-[0px] pl-[4px] pr-[0px]"
                                >
                                    <div
                                            class="w-[32px] h-[32px] rounded-[500px] flex flex-row items-center justify-center p-[8px] box-border"
                                    >
                                        <img
                                                alt=""
                                                class="h-[16px] w-[16px] relative"
                                                src="/image/domestic-accommodations/svg-3.svg"
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
</div>
<div class="h-full w-full fixed top-0 left-0 items-center justify-center bg-gray-800 bg-opacity-50 hidden"
     id="modal-wrap">
    <div class="bg-white w-[90%] h-[90%]" id="modal"  th:include="~{/search/modal :: search_modal}"></div>
</div>
<script src="https://code.jquery.com/jquery-3.7.1.slim.js" integrity="sha256-UgvvN8vBkgO0luPSUl2s8TIlOSYRoGFAX4jlCIm9Adc=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/nouislider/dist/nouislider.min.js"></script>
<script
        src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=NzqUDqweAh8UqE9Z07ze639x6Wlbcgya9sqhnjXH"></script>
<script src="/js/countperson.js"></script>
<script>
    let hCate;
    let f_idx = [];

    $(document).ready(function () {
        initializeSlider('main');  // 메인 슬라���더 초기화
        initializeFilters('main'); // 초기 필터 상태 설정

        let s_count = sessionStorage.getItem('count');
        if (s_count) {
            $("#person_count2").val(s_count);
        }

        // 초기 드롭다운 메뉴 설정
        $("#dropdown-filter-button").text("평점높은순");
        $("#dropdown-filter-button").val("rating");

        // 드롭다운 메뉴 클릭 핸들러
        $('#dropdown-filter .dropdown-item').on('click', function () {
            var selectedText = $(this).text();
            var selectedValue = $(this).attr('value');

            $('#dropdown-filter-button').text(selectedText);
            $('#dropdown-filter-button').val(selectedValue);
            handleFilter('main'); // 필터 변경 시 상태 저장
        });

        // 시설 필터 버튼 클릭 이벤트 핸들러
        const btns = document.querySelectorAll('[id^="f_idx"]');
        btns.forEach(btn => {
            btn.addEventListener('click', () => {
                if (btn.classList.contains('bg-gray-300')) {
                    btn.classList.remove('bg-gray-300');
                    btn.classList.remove('f_idx');
                } else {
                    btn.classList.add('bg-gray-300');
                    btn.classList.add('f_idx');
                }
                handleFilter('main'); // 필터 변경 시 상태 저장
            });
        });
    });

    // 슬라이더 초기화 함수
    function initializeSlider(identifier) {
        var sliderElement = document.getElementById('slider-' + identifier);
        var valueElement = document.getElementById('price-range-value-' + identifier);
        var startInput = document.getElementById('slider-start-' + identifier);
        var endInput = document.getElementById('slider-end-' + identifier);

        if (sliderElement.noUiSlider) {
            sliderElement.noUiSlider.destroy();
        }

        noUiSlider.create(sliderElement, {
            start: [0, 500000],
            connect: true,
            range: {
                'min': 0,
                '10%': 30000,
                '20%': 50000,
                '30%': 100000,
                '50%': 200000,
                '70%': 300000,
                '90%': 400000,
                'max': 500000
            },
            snap: true // 스냅 기능 활성화
        });

        sliderElement.noUiSlider.on('update', function (values, handle) {
            var startValue = parseInt(values[0]);
            var endValue = parseInt(values[1]);

            if (endValue === 500000) {
                valueElement.innerText = startValue + '원 - ' + '500,000원 이상';
            } else {
                valueElement.innerText = startValue + '원 - ' + endValue + '원 미만';
            }

            startInput.value = startValue;
            endInput.value = endValue;
        });

        // 초기 필터 상태 설정
        handleFilter(identifier);
    }

    // 모달 창 열기
    function showmap() {
        copyFilter('modal');

        $("#search_bar").css("display", "none");
        $("#main-filter").css("display", "none");
        $("#searchbar").css("display", "none");
        $("#modal-wrap").css("display", "flex");
        $("body").css("overflow", "hidden");
        $("footer").css("display", "none");
        loadTmap();

        initializeSlider('modal'); // 모달 슬라이더 초기화
    }

    // 모달 창 닫기
    $("#modal_close").click(function () {
        $("#search_bar").css("display", "flex");
        $("#main-filter").css("display", "flex");
        $("#modal-wrap").css("display", "none");
        $("#searchbar").css("display", "flex");
        $("body").css("overflow", "auto");
        $("footer").css("display", "flex");

        copyFilter('main');
    });

    // 메인 필터를 모달 필터로 복사
    function copyFilter(subject) {
        const facilities = JSON.parse(sessionStorage.getItem('facilities') || '[]');
        const selectedHCate = sessionStorage.getItem('hCate');
        const startPrice = sessionStorage.getItem('startPrice');
        const endPrice = sessionStorage.getItem('endPrice');

        console.log(facilities, selectedHCate, startPrice, endPrice + "되냐?");

        // 모달 필터 초기값 설정
        initializeFilters(subject, facilities, selectedHCate, startPrice, endPrice);
    }

    // 필터 초기화 함수
    function initializeFilters(identifier, facilities = null, hCate = null, startPrice = null, endPrice = null) {
        const isMain = (identifier === 'main');

        if (!facilities) {
            facilities = isMain ? JSON.parse(sessionStorage.getItem('facilities') || '[]') : [];
        }
        if (!hCate) {
            hCate = isMain ? sessionStorage.getItem('hCate') : null;
            console.log("하이" + hCate);
        }
        if (!startPrice) {
            startPrice = isMain ? sessionStorage.getItem('startPrice') : null;
        }
        if (!endPrice) {
            endPrice = isMain ? sessionStorage.getItem('endPrice') : null;
        }

        const prefix = identifier === 'modal' ? '#modal ' : '';

        // 시설 필터 초기화
        const f_idxElements = document.querySelectorAll(`${prefix}button[name="f_idx"]`);
        f_idxElements.forEach(elem => {
            elem.classList.remove('bg-gray-300');
        });

        // 숙소 유형 필터 초기화
        const hCateElements = document.querySelectorAll(`${prefix}input[name="hCate"]`);
        hCateElements.forEach(elem => {
            elem.checked = false;
        });

        // 시설 필터 설정
        if (Array.isArray(facilities)) {
            facilities.forEach(facility => {
                const element = document.querySelector(`${prefix}button[name="f_idx"][value="${facility}"]`);
                if (element) {
                    element.classList.add('bg-gray-300');
                }
            });
        }

        // 카테고리 필터 설정
        if (hCate) {
            const hCateElement = document.querySelector(`${prefix}input[name="hCate"][value="${hCate}"]`);
            console.log(hCateElement);
            if (hCateElement) {
                hCateElement.checked = true;
            }
        } else if (isMain) {
            const defaultAllElement = document.querySelector(`${prefix}input[name="hCate"][value="all"]`);
            if (defaultAllElement) {
                defaultAllElement.checked = true;
            }
        }

        // 가격 필터 설정
        if (startPrice) {
            const startPriceElement = document.querySelector(`${prefix}#slider-start-${identifier}`);
            if (startPriceElement) {
                startPriceElement.value = startPrice;
            }
        }

        if (endPrice) {
            const endPriceElement = document.querySelector(`${prefix}#slider-end-${identifier}`);
            if (endPriceElement) {
                endPriceElement.value = endPrice;
            }
        }
    }

    // 필터 상태 저장 함수
    function handleFilter(identifier) {
        console.log(identifier)
        const isMain = (identifier === 'main');
        const prefix = isMain ? '' : '#modal '; // 모달 창에서만 사용되는 접두사

        const f_idxElements = document.querySelectorAll(`${prefix}.f_idx`);
        const facilities = Array.from(f_idxElements, elem => elem.value);

        const hCateElement = document.querySelector(`${prefix}input[name="hCate"]:checked`);
        let hCate = hCateElement ? hCateElement.value : (isMain ? "all" : null);

        let startPriceElement = document.getElementById(`slider-start-${identifier}`);
        let endPriceElement = document.getElementById(`slider-end-${identifier}`);
        let startPrice = startPriceElement ? startPriceElement.value : null;
        let endPrice = endPriceElement ? endPriceElement.value : null;

        let keyword = sessionStorage.getItem('keyword');
        let startDay = sessionStorage.getItem('startDate');
        let endDay = sessionStorage.getItem('endDate');

        let filter = document.getElementById('dropdown-filter-button').value;

        console.log(facilities, hCate, startPrice, endPrice, keyword, startDay, endDay, filter);

        // 필터 상태를 세션 스토리지에 저장 (메인 페이지에서만)
        if (isMain) {
            sessionStorage.setItem('facilities', JSON.stringify(facilities));
            sessionStorage.setItem('hCate', hCate);
            sessionStorage.setItem('startPrice', startPrice);
            sessionStorage.setItem('endPrice', endPrice);
        }

        //iso-8601 형식으로 변환
        if (startDay) {
            startDay = new Date(startDay).toISOString()
        }
        if (endDay) {
            endDay = new Date(endDay).toISOString()
        }

        console.log(facilities, hCate, startPrice, endPrice, keyword, startDay, endDay, filter + "되냐?");
        //ajax 통신
        $.ajax({
            type: "post",
            url: "/search/filtering",
            contentType: "application/json; charset=utf-8",  // JSON 형식으로 전송
            data: JSON.stringify({
                facilities: facilities,
                hCate: hCate,
                startPrice: startPrice,
                endPrice: endPrice,
                keyword: keyword,
                startEndDay: {
                    start: startDay,
                    end: endDay
                },
                filter: filter
            }),
            success: function(data) {
                console.log(data);
            }
        });
    }

    // 티맵 초기화
    var markers = [];
    var map;

    function initTmap() {
        if (!map) {
            map = new Tmapv2.Map("tmap", {
                center: new Tmapv2.LatLng(37.56520450, 126.98702028),
                width: "100%",
                height: "100%",
                zoom: 17
            });
        }
    }

    // 티맵 로드
    function loadTmap() {
        if (typeof Tmapv2 === 'undefined') {
            var script = document.createElement('script');
            script.src = 'https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=NzqUDqweAh8UqE9Z07ze639x6Wlbcgya9sqhnjXH';
            script.onload = function () {
                initTmap();
                addMarkersTooMuch();
            };
            document.body.appendChild(script);
        } else {
            initTmap();
            addMarkersTooMuch();
        }
    }

    // 마커 추가
    function addMarkersTooMuch() {
        removeMarkers();
        for (var i = 0; i < 100; i++) {
            var lat = Math.random() / 100;
            var lng = Math.random() / 100;
            var position = new Tmapv2.LatLng(37.56220450 + lat, 126.98402028 + lng);

            var markerElement = `
            <span class="ballon relative max-w-xs bg-gray-800 text-white rounded p-2 inline-block text-center">
                크크루삥뽕
                <span class="absolute border-gray-800 border-l-transparent border-r-transparent border-t-8 border-l-8 border-r-8 -bottom-2 left-1/2 transform -translate-x-1/2"></span>
            </span>
            `;

            var marker = new Tmapv2.Marker({
                position: position,
                iconHTML: markerElement
            });

            marker.setMap(map);
            markers.push(marker);
        }
    }

    // 마커 제거
    function removeMarkers() {
        for (var i = 0; i < markers.length; i++) {
            markers[i].setMap(null);
        }
        markers = [];
    }
</script>
</body>
</html>
