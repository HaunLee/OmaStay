<!DOCTYPE html>
<html
  lang="ko"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/main}"
  layout:fragment="main"
>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/3.0.1/js.cookie.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
    <meta charset="utf-8" />
  </head>
  <body>
    <div
      class="w-full relative overflow-y-auto flex flex-row items-start justify-center leading-[normal] tracking-[normal]"
    >
      <main
        class="flex-1 bg-[#fff] border-[#707070] box-border flex flex-row items-start justify-center gap-[47px] max-w-full text-left text-[20px] text-[#000] font-[Roboto] mq800:gap-[23px] mq1325:flex-wrap"
      >
        <div
          class="h-[1363px] w-[374px] overflow-hidden shrink-0 flex flex-row items-start justify-start py-[44px] px-[38px] box-border min-w-[374px] max-w-full mq450:pt-[29px] mq450:pb-[29px] mq450:box-border mq450:min-w-full mq1325:flex-1"
        >
          <div class="flex-1 flex flex-col items-start justify-start">
            <div
              class="self-stretch rounded-t-[10px] rounded-b-[0px] bg-[#fff] border-[#c2c2c2] border-[1px] border-solid overflow-hidden flex flex-row items-start justify-start pt-[23px] px-[37px] pb-[14px]"
            >
              <div
                class="w-[97px] overflow-hidden shrink-0 flex flex-row items-start justify-start pt-[0px] px-[0px] pb-[5px] box-border"
              >
                <a
                  class="[text-decoration:none] flex-1 relative text-[inherit] mq450:text-[16px]"
                  >예약 내역</a
                >
              </div>
            </div>
            <div
              class="self-stretch bg-[#fff] border-[#c2c2c2] border-r-[1px] border-solid border-[#c2c2c2] border-l-[1px] border-solid overflow-hidden flex flex-row items-start justify-start pt-[20px] px-[38px] pb-[21px]"
            >
              <div
                class="w-[97px] overflow-hidden shrink-0 flex flex-row items-start justify-start"
              >
                <div
                  class="h-[33px] flex-1 relative flex items-center mq450:text-[16px]"
                >
                  포인트
                </div>
              </div>
            </div>
            <div
              class="self-stretch bg-[#fff] border-[#c2c2c2] border-t-[1px] border-solid border-[#c2c2c2] border-r-[1px] border-solid border-[#c2c2c2] border-l-[1px] border-solid overflow-hidden flex flex-row items-start justify-start pt-[18px] px-[36px] pb-[21px]"
            >
              <div
                class="w-[97px] overflow-hidden shrink-0 flex flex-row items-start justify-start"
              >
                <div
                  class="h-[33px] flex-1 relative flex items-center mq450:text-[16px]"
                >
                  쿠폰
                </div>
              </div>
            </div>
            <div
              class="self-stretch bg-[#fff] border-[#c2c2c2] border-t-[1px] border-solid border-[#c2c2c2] border-r-[1px] border-solid border-[#c2c2c2] border-l-[1px] border-solid overflow-hidden flex flex-row items-start justify-start pt-[18px] px-[35px] pb-[21px]"
            >
              <div
                class="w-[113px] overflow-hidden shrink-0 flex flex-row items-start justify-start pt-[0px] px-[0px] pb-[5px] box-border"
              >
                <div class="flex-1 relative mq450:text-[16px]">
                  내 정보 관리
                </div>
              </div>
            </div>
            <div
              class="self-stretch rounded-t-[0px] rounded-b-[10px] bg-[#fff] border-[#c2c2c2] border-[1px] border-solid overflow-hidden flex flex-row items-start justify-start pt-[18px] px-[33px] pb-[19px]"
            >
              <div
                class="w-[76px] overflow-hidden shrink-0 flex flex-row items-start justify-start pt-[0px] px-[0px] pb-[5px] box-border"
              >
                <div class="flex-1 relative mq450:text-[16px]">내 리뷰</div>
              </div>
            </div>
          </div>
        </div>
        <div
          class="w-[973px] flex flex-col items-start justify-start pt-[69.5px] px-[0px] pb-[0px] box-border min-w-[973px] max-w-full text-[24px] text-[#333] mq800:pt-[29px] mq800:box-border mq1125:min-w-full mq1325:flex-1 mq1325:pt-[45px] mq1325:box-border"
        >
          <div
            class="self-stretch flex flex-col items-start justify-start gap-[46px] max-w-full mq800:gap-[23px]"
          >
            <div
              class="self-stretch flex flex-row items-start justify-start py-[0px] pl-[1px] pr-[0px] box-border max-w-full text-[22.5px]"
            >
              <div
                class="flex-1 flex flex-col items-end justify-start gap-[23px] max-w-full"
              >
                <div
                  class="self-stretch flex flex-row items-start justify-start pt-[0px] px-[6px] pb-[11.5px]"
                >
                  <div
                    class="w-[211.8px] flex flex-row items-start justify-start py-[0px] pl-[0px] pr-[20px] box-border gap-[10px]"
                  >
                    <div
                      class="flex flex-col items-start justify-start pt-[2.5px] px-[0px] pb-[0px]"
                    >
                      <img
                        class="w-[20px] h-[20px] relative shrink-0"
                        loading="lazy"
                        alt=""
                        src="/image/reservation/svg.svg"
                      />
                    </div>
                    <div
                      class="h-[25px] flex-1 overflow-hidden flex flex-row items-start justify-start shrink-0"
                    >
                      <a
                        class="[text-decoration:none] flex-1 relative leading-[29px] font-bold text-[inherit] shrink-0 mq450:text-[18px] mq450:leading-[23px]"
                        >예약 내역 상세</a
                      >
                    </div>
                  </div>
                </div>
                <header
                  class="self-stretch flex flex-col items-start justify-start gap-[21px] text-left text-[24px] text-[#333] font-[Roboto]"
                >
                  <div
                    class="w-[114px] flex flex-row items-start justify-start py-[0px] px-[6px] box-border"
                  >
                    <a
                      class="[text-decoration:none] flex-1 relative leading-[21px] font-bold text-[inherit]"
                      >예약확정</a
                    >
                  </div>
                  <div
                    class="w-full [border:none] [outline:none] bg-[rgba(2,72,252,0.76)] self-stretch h-[37px] rounded-[10px] overflow-hidden shrink-0 flex flex-row items-start justify-start pt-[8px] px-[21px] pb-[8px] box-border font-[Roboto] font-bold text-[14px] text-[#fff] min-w-[250px]"
                    ><span id="checkInDate"></span><span id="checkIn"></span> 부터 체크인 가능해요~!</div>
                </header>
                <div
                  class="self-stretch flex flex-col items-start justify-start pt-[0px] pb-[14px] pl-[6px] pr-[0px] box-border gap-[20px] max-w-full text-[13.2px]"
                >
                  <div
                    class="w-[550px] flex flex-row items-start justify-start py-[0px] px-[17px] box-border max-w-full text-[16px]"
                  >
                    <div
                      class="flex-1 flex flex-col items-start justify-start gap-[20px] max-w-full"
                    >
                      <div
                        class="w-[424px] flex flex-row items-start justify-start py-[0px] pl-[0px] pr-[20px] box-border gap-[30px] max-w-full mq450:flex-wrap"
                      >
                        <img src="" alt="호텔사진" id="img"
                          class="h-[145px] w-[151px] relative rounded-[10px] bg-[#999] min-w-[151px] mq450:flex-1"
                        ></img>
                        <div
                          class="flex-1 flex flex-col items-start justify-start pt-[19px] px-[0px] pb-[0px] box-border min-w-[145px]"
                        >
                          <div
                            class="self-stretch flex flex-col items-start justify-start gap-[20px]"
                          >
                            <b
                              id="hName"
                              class="w-[175px] relative leading-[23px] flex items-center"
                              ></b
                            >
                            <b
                              id="hAddress"
                              class="self-stretch relative text-[12px] leading-[21px] text-[#999] w-[300px]"
                              ></b
                            >
                          </div>
                        </div>
                      </div>
                      <div
                        class="self-stretch flex flex-row items-start justify-start py-[0px] pl-[19px] pr-[0px] box-border max-w-full text-[13.2px] text-[#8e8888]"
                      >
                        <div
                          class="flex-1 flex flex-row items-start justify-start gap-[48px] max-w-full mq450:flex-wrap mq800:gap-[24px]"
                        >
                          <b
                            class="w-[59px] relative leading-[20px] flex items-center shrink-0"
                            >일정</b
                          >
                          <b
                            id="resDate"
                            class="flex-1 relative text-[12px] leading-[20px] inline-block text-[rgba(0,0,0,0.87)] min-w-[39px] max-w-full"
                            ></b
                          >
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    class="self-stretch flex flex-col items-start justify-start pt-[0px] px-[0px] pb-[19px] gap-[12px] text-[#8e8888]"
                  >
                    <div
                      class="w-[308px] flex flex-row items-start justify-start py-[0px] px-[36px] box-border"
                    >
                      <div
                        class="flex-1 flex flex-row items-start justify-between gap-[20px]"
                      >
                        <b
                          class="w-[59px] relative leading-[20px] flex items-center shrink-0"
                          >객실이름</b
                        >
                        <div
                          class="w-[131px] flex flex-col items-start justify-start gap-[9px] text-[12px] text-[rgba(0,0,0,0.87)]"
                        >
                          <b id="roomName" class="self-stretch relative leading-[20px]"
                            ></b
                          >
                          <button onclick="openRoomModal()"
                            class="w-[70px] h-[35px] text-[14px] leading-[20px] flex items-center justify-center text-white bg-blue-500 hover:bg-blue-600 active:bg-blue-700 rounded-md shadow-md transition-all duration-300 ease-in-out relative mt-[5px]"
                            >구매정보</button
                          >
                              <!-- 모달 백그라운드 -->
                          <div
                          id="roomInfoModal"
                          class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
                        >
                            <!-- 모달 닫기 버튼 -->
                            <button
                              onclick="closeRoomModal()"
                              class="text-right mb-4 text-[20px] text-gray-600 hover:text-gray-900"
                            >
                              &times;
                            </button>

                            <!-- AJAX로 불러온 HTML이 삽입될 영역 -->
                            <div id="modalContent" class="w-full">
                              <!-- 여기에 AJAX로 불러온 HTML이 들어갑니다 -->
                            </div>
                        </div>
                        </div>
                      </div>
                    </div>
                    <div
                      class="self-stretch h-[3px] relative bg-[#f5f5f5]"
                    ></div>
                  </div>
                  <div
                    class="flex flex-row items-start justify-start pt-[0px] px-[26px] pb-[6px] text-[24px]"
                  >
                    <h1
                      class="m-[0px] relative text-inherit leading-[21px] font-bold font-[inherit] inline-block min-w-[102px] mq450:text-[19px] mq450:leading-[17px]"
                    >
                      예약 정보
                    </h1>
                  </div>
                  <div
                    class="w-[554px] flex flex-row items-start justify-start py-[0px] px-[30px] box-border max-w-full text-[#8e8888]"
                  >
                    <div
                      class="flex-1 flex flex-row items-end justify-start gap-[15px] max-w-full mq450:flex-wrap"
                    >
                      <div
                        class="w-[89px] flex flex-col items-start justify-start gap-[15px]"
                      >
                        <b
                          class="w-[59px] relative leading-[20px] flex items-center"
                          >예약번호</b
                        >
                        <b class="self-stretch relative leading-[20px]"
                          >예약자 이름</b
                        >
                        <b class="self-stretch relative leading-[20px]"
                          >예약자 이메일</b
                        >
                      </div>
                      <div
                        class="flex-1 flex flex-col items-start justify-start gap-[14.5px] min-w-[253px] max-w-full text-[12px] text-[rgba(0,0,0,0.87)]"
                      >
                        <b
                          id="resNum"
                          class="self-stretch relative leading-[20px]"
                        ></b>
                        <div
                          class="w-[133px] flex flex-row items-start justify-start py-[0px] px-[1px] box-border"
                        >
                          <b
                            id="reserverName"
                            class="flex-1 relative leading-[20px]"
                          ></b>
                        </div>
                        <div
                          class="w-[133px] flex flex-row items-start justify-start py-[0px] px-[1px] box-border"
                        >
                          <b
                            id="reserverEmail"
                            class="flex-1 relative leading-[20px]"
                          ></b>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="self-stretch h-[3px] relative bg-[#f5f5f5]"></div>
              </div>
            </div>
            <div
              class="w-[943px] flex flex-row items-start justify-start pt-[0px] px-[38px] pb-[6px] box-border max-w-full"
            >
              <div
                class="flex-1 flex flex-col items-start justify-start gap-[30px] max-w-full"
              >
                <h1
                  class="m-[0px] relative text-inherit leading-[21px] font-bold font-[inherit] inline-block min-w-[102px] mq450:text-[19px] mq450:leading-[17px]"
                >
                  결제 정보
                </h1>
                <div
                  class="self-stretch flex flex-row items-start justify-start [row-gap:20px] max-w-full text-[13.2px] text-[#8e8888] mq800:flex-wrap"
                >
                  <div
                    class="w-[411px] bg-[#f7f7f7] overflow-hidden shrink-0 flex flex-row items-start justify-start p-[24px] box-border gap-[59px] min-w-[411px] min-h-[251px] max-w-full z-[1] mq450:gap-[29px] mq450:flex-wrap mq800:flex-1 mq800:min-w-full"
                  >
                    <div
                      class="w-[151px] flex flex-col items-start justify-start gap-[14px]"
                    >
                      <div
                        class="self-stretch flex flex-row items-start justify-start py-[0px] pl-[1px] pr-[4px]"
                      >
                        <b class="flex-1 relative leading-[20px]">결제 일시</b>
                      </div>
                      <b class="self-stretch relative leading-[20px]"
                        >결제 수단</b
                      >
                    </div>
                    <div
                      class="w-[133px] flex flex-col items-start justify-end pt-[0px] px-[0px] pb-[1px] box-border text-right text-[12px] text-[#707070]"
                    >
                      <div
                        class="self-stretch flex flex-col items-end justify-start gap-[11px]"
                      >
                        <b
                          id="payDate"
                          class="w-[124px] relative leading-[20px] flex justify-end items-center min-w-[124px] whitespace-nowrap"
                        ></b>
                        <div
                          class="self-stretch flex flex-row items-start justify-end py-[0px] pl-[0px] pr-[1px]"
                        >
                          <b
                            id="payMethod"
                            class="flex-1 relative leading-[20px]"
                          ></b>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    class="flex-1 overflow-hidden flex flex-col items-end justify-start pt-[14px] px-[0px] pb-[30px] box-border gap-[14px] min-w-[296px] max-w-full z-[2]"
                  >
                    <div
                      class="w-[441px] flex flex-col items-end justify-start pt-[0px] px-[0px] box-border gap-[11px] max-w-full"
                    >
                    
                      <div
                        class="self-stretch flex flex-col items-start justify-start gap-[4px] max-w-full"
                      >
                        <div
                          class="self-stretch flex flex-row items-start justify-start py-[0px] pl-[1px] pr-[0px] box-border max-w-full"
                        >
                          <div
                            class="flex-1 flex flex-row items-start justify-between pt-[3px] pb-[16px] pl-[10px] pr-[20px] box-border max-w-full gap-[20px] mq450:flex-wrap"
                          >
                            <div
                              class="w-[166px] flex flex-col items-start justify-start pt-[2px] px-[0px] pb-[0px] box-border"
                            >
                              <b
                                class="self-stretch relative leading-[20px] justify-end"
                                >객실 가격</b
                              >
                            </div>
                            <b
                              id="nsalePrice"
                              class="w-[124px] relative text-[12px] leading-[20px] flex text-[#707070] text-right items-center shrink-0 justify-end"
                            >
                              원</b
                            >
                          </div>
                          <div
                          class="self-stretch flex flex-row items-start justify-start py-[0px] pl-[1px] pr-[0px] box-border max-w-full"
                        >
                      </div>
                    </div>
                    <div
                        class="self-stretch flex flex-row items-start justify-start py-[0px] pl-[1px] pr-[0px] box-border max-w-full"
                      >
                        <div
                          class="flex-1 flex flex-row items-start justify-between pt-[3px] pb-[16px] pl-[10px] pr-[20px] box-border max-w-full gap-[20px] mq450:flex-wrap"
                        >
                          <div
                            class="w-[166px] flex flex-col items-start justify-start pt-[2px] px-[0px] pb-[0px] box-border"
                          >
                            <b class="self-stretch relative leading-[20px] justify-end">멤버십 할인</b>
                          </div>
                          <b
                            id="membershipDiscount"
                            class="w-[124px] relative text-[12px] leading-[20px] flex text-[#707070] text-right items-center shrink-0 justify-end"
                          >
                          </b>
                        </div>
                      </div>
                        <div
                          class="self-stretch flex flex-row items-start justify-between pt-[2px] pb-[11px] pl-[10px] pr-[19px] gap-[20px] mq450:flex-wrap"
                        >
                          <div
                            class="w-[139px] flex flex-col items-start justify-start pt-[3px] px-[0px] pb-[0px] box-border"
                          >
                            <b class="self-stretch relative leading-[20px]"
                              >적용 쿠폰</b
                            >
                          </div>
                          <b
                            id="payCoupon"
                            class="w-[124px] relative text-[12px] leading-[20px] flex text-[#707070] text-right items-center shrink-0 justify-end"
                          ></b>
                        </div>
                      </div>
                      <div
                        class="self-stretch flex flex-row items-start justify-between pt-[3px] pb-[6px] pl-[10px] pr-[23px] gap-[20px] mq450:flex-wrap"
                      >
                        <b
                          class="mt-[-7px] w-[166px] relative leading-[20px] flex items-center shrink-0"
                          >사용 포인트</b
                        >
                        <b
                          id="payPoint"
                          class="w-[126px] relative text-[12px] leading-[21px] flex text-[#707070] text-right items-center shrink-0 justify-end mr-[-4px]"
                        >
                        </b>
                      </div>
                    </div>
                    <div
                      class="self-stretch h-[3px] relative bg-[#f5f5f5]"
                    ></div>
                    <div
                      class="w-[441px] flex flex-row items-start justify-between pt-[0px] pb-[12px] pl-[10px] pr-[18px] box-border gap-[20px] max-w-full mq450:flex-wrap"
                    >
                      <b
                        class="w-[166px] relative leading-[20px] flex items-center shrink-0"
                        >최종 결제 금액</b
                      >
                      <div
                        class="w-[124px] flex flex-col items-start justify-start pt-[2px] px-[0px] pb-[0px] box-border text-right text-[12px] text-[#f21111]"
                      >
                        <b
                          id="totalAmount"
                          class="self-stretch relative leading-[20px]"
                        ></b>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="self-stretch flex flex-col items-start justify-start py-[0px] pl-[0px] pr-[3px] box-border gap-[25px] max-w-full"
            >
              <div
                class="self-stretch h-[1px] flex flex-row items-start justify-start py-[0px] pl-[1px] pr-[0px] box-border max-w-full"
              >
                <div
                  class="self-stretch flex-1 relative bg-[#f5f5f5] max-w-full"
                ></div>
              </div>
              <div
                class="w-[943px] overflow-hidden flex flex-col items-start justify-start pt-[28px] px-[44px] pb-[0px] box-border gap-[19px] max-w-full mq1125:pl-[22px] mq1125:pr-[22px] mq1125:box-border"
              >
                <h1
                  class="m-[0px] relative text-inherit leading-[21px] font-bold font-[inherit] inline-block min-w-[102px] mq450:text-[19px] mq450:leading-[17px]"
                >
                  예약 취소
                </h1>
                <div
                  class="w-[936px] h-[76px] relative max-w-[110%] shrink-0 text-[20px] text-[rgba(254,119,119,0.87)] mb-[50px]"
                >
                  <h2
                    class="m-[0px] absolute top-[0px] left-[0px] text-inherit leading-[20px] font-bold font-[inherit] flex items-center w-full h-full mq450:text-[16px] mq450:leading-[16px]"
                  >
                    취소 수수료 5%가 발생합니다
                  </h2>
                  <button
                    id="cancelBtn"
                    class="cursor-pointer [border:none] py-[11.5px] px-[16px] bg-[#fcd4d4] absolute top-[17px] left-[774px] rounded-[10px] flex flex-row items-start justify-start whitespace-nowrap z-[1] hover:bg-[#e3baba]"
                  >
                    예약취소
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div id="cancelModalContent" class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center hidden z-50">
          <div class="bg-white rounded-lg shadow-lg max-w-lg w-full p-6"></div>
      </div>
      </main>
    </div>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
      let start;
      let end;
      let roomRule;
      let payIdx;
      let icIdx;
      let resIdx;
      let user = JSON.parse(localStorage.getItem("user"));
      let img;
      let cancelPrice;

      function formatDateToKorean(dateString) {
        // 문자열을 Date 객체로 변환
        const date = new Date(dateString);

        // 요일 배열
        const days = ["일", "월", "화", "수", "목", "금", "토"];

        // Date 객체에서 연, 월, 일, 요일 추출
        const year = date.getFullYear();
        const month = date.getMonth() + 1; // 월은 0부터 시작하므로 1을 더해줍니다.
        const day = date.getDate();
        const dayOfWeek = days[date.getDay()]; // getDay()는 요일을 숫자로 반환 (일요일: 0 ~ 토요일: 6)

        // 원하는 형식으로 문자열 반환
        return `${year}년 ${month}월 ${day}일 (${dayOfWeek}) `;
      }

      function formatDate(dateString) {
        return dateString.slice(0, 10); // 앞에서부터 10글자만 자름 (YYYY-MM-DD 형식)
      }
      
      function openRoomModal() {
        $.ajax({
          url: '/mypage/room_info', // 불러올 HTML 파일 경로
          method: 'GET'
        }).done(function(data){
          console.log(data);

          $('#modalContent').html(data);
            // 모달을 보이도록 설정
          $('#roomInfoModal').removeClass('hidden');

           // 닫기 버튼 클릭 시 모달 닫기 기능 추가
           $('#closeModalButton, #close').click(function () {
            closeRoomModal();
            });

            $("#roomSelectDate").text(start);
            $("#startDate").text(start);
            $("#endDate").text(end);
            $("#roomRule").text(roomRule);
            $("#roomImg").attr("src", img);

        });
      }

      function closeRoomModal() {
        $('#roomInfoModal').addClass('hidden');
      }

      $(function () {
        let urlParams = new URLSearchParams(window.location.search);
        let id = urlParams.get("id"); // 'id' 파라미터 값을 추출
        console.log(id);

        let paymentKey; // 전역 변수로 paymentKey를 저장할 변수 선언
        
        
        let payInfo;
        // 예약 정보를 불러오는 AJAX 요청
        $.ajax({
          url: "/mypage/reservation_check", // 호출하고자 하는 URL
          method: "POST",
          contentType: "application/json; charset=utf-8",
          data: JSON.stringify({ id }), // member 객체를 JSON으로 변환해서 전송
        }).done(function (res) {
          console.log(res);
          paymentKey = res.payment.paymentKey;
          payIdx = res.payment.id;
          payInfo = res.payment;

          img = res.image;
          let hName = res.host.hname;
          let hAddress = res.host.addressVo.street;
          roomRule = res.host.rules;
          let resDate = res.reservation.startEndVo;
          let roomName = res.room.roomName;
          let checkIn = res.host.checkin;
          
          resIdx = res.reservation.id;
          let resNum = res.reservation.resNum;
          let reserverName = res.reservation.resName;
          let reserverEmail = res.reservation.resEmail;
          let date = res.payment.payDate;
          let payMethod = res.payment.payMethod;
          let nSale = res.payment.nsalePrice;
          let totalAmount = res.payment.amount;
          let coupon = res.payment.payCoupon;
          let point = res.payment.payPoint;
          let payGrade = res.payment.payGrade;
          icIdx = res.payment.icIdx;
          let payDate = formatDate(date);

          start = formatDate(resDate.start);
          end = formatDate(resDate.end);
          console.log(img);
          console.log("start" + start);

          let formattedDate = formatDateToKorean(start);
          $("#checkInDate").text(formattedDate);


          $("#img").attr("src", img);
          $("#hName").text(hName);
          $("#hAddress").text(hAddress);
          $("#resDate").text(start + " ~ " + end);
          $("#roomName").text(roomName);
          $("#checkIn").text(checkIn);

          $("#resNum").text(resNum);
          $("#reserverName").text(reserverName);
          $("#reserverEmail").text(reserverEmail);
          $("#payDate").text(payDate);
          $("#payMethod").text(payMethod);
          $("#nsalePrice").text(nSale + " 원");
          $("#totalAmount").text(totalAmount + " 원");
          $("#membershipDiscount").text(payGrade + "원");

          if (coupon == null) {
            coupon = 0;
          }

          if (point == null) {
            point = 0;
          }

          $("#payCoupon").text(coupon + " 원");
          $("#payPoint").text(point + " 원");

          // start 날짜가 오늘 날짜보다 하루 전인지 확인하는 함수
          function isPastOneDay(startDate) {
            const today = new Date();
            const start = new Date(startDate);
            const oneDayBeforeStart = new Date(start);
            oneDayBeforeStart.setDate(start.getDate() - 1); // start 날짜의 하루 전

            // 오늘 날짜와 하루 전 날짜를 비교
            return today >= oneDayBeforeStart;
          }

          // 날짜 비교 후 조건에 맞는지 확인하고 텍스트 및 버튼 변경
          if (isPastOneDay(start)) {
            // 텍스트 변경
            $("h2").text("하루전에는 취소가 불가능합니다");

            // 버튼 숨기기
            $("#cancelBtn").hide();
          }

        });
      });

      $("#cancelBtn").click(function(){
          $.ajax({
              url: "/mypage/noCancel_content",
              method: "GET",
            }).done(function (data) {
                $("#cancelModalContent").removeClass("hidden");
                $("#cancelModalContent").html(data);
                $.ajax({
                  url: "/mypage/noCancel_content",
                  method: "POST",
                  data: {
                      id: payIdx,
                  },
                }).done(function (data) {
                  console.log(data);
                  let pointId = data.payment.pidx;
                  $("#closeNoCancelModal").click(function(){
                    $("#cancelModalContent").addClass("hidden")
                  });
                  let price = data.payment.amount;
                  cancelPrice = price * 0.95;

                  $("#totalPrice").text(cancelPrice);
                  $("#paymentPrice").text(parseInt(data.payment.amount));
                  $("#paymentMethod").text(data.payment.payMethod);
                  $("#pointPrice").text(data.payment.payPoint);
                  $("#couponPrice").text(data.payment.payCoupon);
                  
                  $("#cancelModalBtn").click(function () {
                  let cancelReason = $("#cancelReason").val();
                  if( !cancelReason){
                      alert("취소사유를 선택해주세요")
                      return;
                  }
                  let chk = confirm("정말로 예약을 취소하시겠습니까?");
                  if (chk) {
                    console.log(pointId)
                    // paymentKey 변수를 취소 요청에 사용
                    $.ajax({
                    url: "/payment/cancel", // 호출하고자 하는 URL
                    method: "POST",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify({
                        paymentKey: data.payment.paymentKey, // res.payment.paymentKey 값을 사용
                        cancelReason: cancelReason, // 실제 데이터 값 확인
                        payIdx: payIdx,
                        resIdx :resIdx,
                        icIdx: icIdx ? icIdx : null,
                        pIdx: pointId ? pointId : null,
                        memIdx: user.id,
                        cancelAmount: cancelPrice 
                    }),
                    }).done(function (res) {
                    alert("예약이 취소되었습니다.");
                    location.href = "/";
                    });
                }
                });

                $("#closePay").click(function () {
                    $("#cancelModalContent").addClass("hidden");
                });
              });
            });
        })
    </script>
  </body>
</html>
